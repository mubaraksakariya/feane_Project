{% extends 'base.html' %}

{% block page-content %}
<style>
#addForm{
    display: none;
}
</style>
<div class="container py-4">
    <div class="row justify-content-center g-2 ">
        <div class="col-lg-4 ">
            {% for item in cart %}
            <div>         
                <div class="card w-100">
                    <div class=" d-flex justify-content-center ">
                        <img class="img-thumbnail w-25" src="{{item.product.product_image.image1.url}}" class="card-img-top" alt="...">
                    </div>
                    <div class="card-body">
                        <a href="{% url 'product' item.product.id %}">
                            <h5 class="card-title"> {{item.product.product_name}} </h5>
                        </a>
                        <div class="d-flex justify-content-end">
                            <span class="list-group-item px-2 ">Rs {{item.product.product_prize}}</span>
                            
                        </div>
                        
                    </div>
                
                    <!-- <div class="card-body">
                        <a href="{% url 'removefromcart' item.id %}" class="card-link text-danger">Remove item</a>
                    </div> -->
                </div>
            </div> 
            {% endfor %}
        </div>
        <div class="col-lg-4">
            <div class="card w-100">
                <h4 class="h4 p-3">Delivery Address</h4>
                {% for item in address %}    
                <div class="form-check mx-3">
                    <input checked class="form-check-input border border-primary" type="radio" name="flexRadioDefault" id="flexRadioDefault1" value = "{{item.id}}">
                    <label class="form-check-label" for="flexRadioDefault1">
                        {{item.building_number}}
                    </label>
                        <p>{{item.building_name}}</p>
                        <p>{{item.phone_number}}</p>
                        <p>{{item.city}}</p>
                </div>
                {% endfor %}
                <div class="d-flex justify-content-center p-2">
                    <button class="btn btn-outline-primary " id="show" onclick="showform()">Add New Address</button>
                </div>
                <div id="addForm">
                    <form action="{% url 'addaddress' user.id %}" method="post" class="w-75">
                        {% csrf_token %}
                        <div>
                            <input type="text" class="form-control m-3 shadow" placeholder="House Number" name="House" required />
                        </div>
                        <div>             
                            <input type="text" class="form-control m-3 shadow" placeholder="Bulding number" name="Bulding" required />
                        </div>
                        <div>             
                            <input type="text" class="form-control m-3 shadow" placeholder="Street" name="Street" required/>
                        </div>
                        <div>               
                            <input type="text" class="form-control m-3 shadow" placeholder="City" name="City" required/>
                        </div>
                        <div>                
                            <input type="text" class="form-control m-3 shadow" placeholder="PIN" name="PIN" required/>
                        </div>
                        <div>               
                            <input type="text" class="form-control m-3 shadow" placeholder="Mobile" name="Mobile" />
                        </div>
                        {% for message in messages %}
                            <span>{{message}}</span>
                        {% endfor %}
                        <div class="btn_box p-3 ">
                            <button class="btn btn-warning " type="submit">
                                ADD
                            </button>
                            <button class="btn btn-danger " onclick="hideform()">
                                Cancel
                            </button>
                            
                        </div>
                    </form>
                    
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div>
                <div class="card w-100">
                    <div class=" p-2 m-4">
                        {% for item in cart %}                        
                        <div class="d-flex justify-content-end">
                            <h6 class="card-title"> {{item.product.product_name}} </h6>
                            <span class="list-group-item px-2">X {{item.quantity}} </span>
                            <div>
                                <p id = "sum" class="px-2">= Rs {{item.total}}</p>
                            </div>
                        </div>  
                        {% endfor %}
                        <div class="d-flex justify-content-end">
                            <span class="px-2">Total </span>
                            <p  class="px-2">= Rs {{total}}</p>
                        </div>
                        
                    </div>
                    
                </div>
            </div>
            <div>
                <div class="card w-100 ">
                    <h4 class="h4 p-4">Payment method</h4>
                    <div class="p-2 ms-4">
                        <div>
                            <input type="radio" name="payment_method" value="cod" checked>
                            <label for="bitcoin">COD</label>
                        </div>
                        <div>
                            <input type="radio" name="payment_method" value="credit_card">
                            <label for="credit_card">Credit card</label>
                        </div>
                        <div>
                            <input type="radio" name="payment_method" value="upi">
                            <label for="paypal">UPI</label>
                        </div>        
                        
                    </div>   
                </div>
                <div class=" p-4" >
                    <form  action="{% url 'placeOrder' %}" method="POST" class=" d-flex justify-content-center text-center" id="placeorder">
                        {% csrf_token %}
                        <input type="text" name="address" id="address" hidden>
                        <input type="text" name="payment" id="payment" hidden>
                        <button class="btn btn-success w-100 btn-lg" type="submit">Place Order</button>
                    </form>
                </div>
            </div>
        </div>      
    </div>    
</div>
<script>
    var form = document.getElementById('addForm')
    var btnshow = document.getElementById('show')
    const Paymentform = document.querySelector('#placeorder');
    const adSelection = document.querySelectorAll('input[name="flexRadioDefault"]');
    const pySelection = document.querySelectorAll('input[name="payment_method"]');
    const address = document.getElementById("address")
    const payment = document.getElementById("payment")
    function showform(){
        form.style.display = 'block' 
        btnshow.style.display = 'none'
    }
    function hideform(){
        form.style.display = 'none' 
        btnshow.style.display = 'block' 
    }

    
    Paymentform.addEventListener('submit', (event) => {
        event.preventDefault();
        for (const radio of adSelection) {
            if (radio.checked) {
                address.value = radio.value;
                break;
            }
        }
        for (const radio of pySelection) {
            if (radio.checked) {
                payment.value = radio.value;
                break;
            }
        }
        Paymentform.submit()
    });
</script>
{% endblock %}